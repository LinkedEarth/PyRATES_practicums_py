
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Chapter 3: Measures of association &#8212; PyRATES practicums with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/Association';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 4: Spectral Analysis" href="Spectral_Analysis_Rio_Grande.html" />
    <link rel="prev" title="Chapter 2: Signal Processing" href="signal_processing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Pyrateslogo.png" class="logo__image only-light" alt="PyRATES practicums with Python - Home"/>
    <script>document.write(`<img src="../_static/Pyrateslogo.png" class="logo__image only-dark" alt="PyRATES practicums with Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    PyRATES: Python and R Analysis of Time Series
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Intro_Mauna_Loa.html">Chapter 1: Introduction to Timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="signal_processing.html">Chapter 2: Signal Processing</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 3: Measures of association</a></li>
<li class="toctree-l1"><a class="reference internal" href="Spectral_Analysis_Rio_Grande.html">Chapter 4: Spectral Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="wavelets%26coherence.html">Chapter 5: Wavelets and Coherency</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/LinkedEarth/PyRATES_practicums_py/main?urlpath=tree/jbook/notebooks/Association.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LinkedEarth/PyRATES_practicums_py" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LinkedEarth/PyRATES_practicums_py/issues/new?title=Issue%20on%20page%20%2Fnotebooks/Association.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/Association.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 3: Measures of association</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling">Data Wrangling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-association">Measuring Association</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spurious-correlations">Spurious Correlations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing-enhanced-correlations">Smoothing-enhanced correlations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trend-enhanced-correlations">Trend-enhanced correlations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#takeways">Takeways</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <img src='http://linked.earth/FROGS/images/Pyrateslogo.jpg' width="400">
<section class="tex2jax_ignore mathjax_ignore" id="chapter-3-measures-of-association">
<h1>Chapter 3: Measures of association<a class="headerlink" href="#chapter-3-measures-of-association" title="Link to this heading">#</a></h1>
<p>In this notebook we explore the relationship between two well-known climate indices, the Southern Oscillation Index (SOI) and the North Atlantic Oscillation (NAO) index.  The NAO and SOI index have been alleged to show some relationship, albeit a subtle one, in some seasons/epochs.
Specifically, we will explore:</p>
<ul class="simple">
<li><p>effects of trends</p></li>
<li><p>effects of autocorrelation</p></li>
<li><p>various measures of association</p></li>
<li><p>various methods of establishing the significance of a relationship</p></li>
</ul>
<section id="data-wrangling">
<h2>Data Wrangling<a class="headerlink" href="#data-wrangling" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>The NAO data are from <a class="reference external" href="https://www.ncei.noaa.gov/access/monitoring/nao/">NCEP</a></p></li>
<li><p>The SOI data ship with <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code>, which houses a few datasets that make it easy to experiment with real-world geoscientific timeseries. To see what is available, do:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyleoclim</span> <span class="k">as</span> <span class="nn">pyleo</span>
<span class="n">pyleo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">available_dataset_names</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;SOI&#39;,
 &#39;NINO3&#39;,
 &#39;HadCRUT5&#39;,
 &#39;AIR&#39;,
 &#39;LR04&#39;,
 &#39;AACO2&#39;,
 &#39;EDC-dD&#39;,
 &#39;GISP2&#39;,
 &#39;cenogrid_d18O&#39;,
 &#39;cenogrid_d13C&#39;]
</pre></div>
</div>
</div>
</div>
<p>To load the SOI, simply do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SOI</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;SOI&#39;</span><span class="p">)</span>
<span class="n">SOI</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;archiveType&#39;: &#39;Instrumental&#39;, &#39;label&#39;: &#39;Southern Oscillation Index&#39;}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
Time [year C.E.]
1951.000000    1.5
1951.083333    0.9
1951.166667   -0.1
1951.250000   -0.3
1951.333333   -0.7
              ... 
2019.583333   -0.1
2019.666667   -1.2
2019.750000   -0.4
2019.833333   -0.8
2019.916667   -0.6
Name: SOI [mb], Length: 828, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SOI</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Time [year C.E.]&#39;, ylabel=&#39;SOI [mb]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/670ec1415a72e7f0d3421f377a0a99bb7ebf0fdb67e10043634475ffd80abfb5.png" src="../_images/670ec1415a72e7f0d3421f377a0a99bb7ebf0fdb67e10043634475ffd80abfb5.png" />
</div>
</div>
<p>That was the easy part. For the NAO index, we have to work a little harder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.cpc.ncep.noaa.gov/products/precip/CWlink/pna/norm.nao.monthly.b5001.current.ascii.table&#39;</span>
<span class="n">df_nao</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_nao</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Jan</th>
      <th>Feb</th>
      <th>Mar</th>
      <th>Apr</th>
      <th>May</th>
      <th>Jun</th>
      <th>Jul</th>
      <th>Aug</th>
      <th>Sep</th>
      <th>Oct</th>
      <th>Nov</th>
      <th>Dec</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1950</th>
      <td>0.92</td>
      <td>0.40</td>
      <td>-0.36</td>
      <td>0.73</td>
      <td>-0.59</td>
      <td>-0.06</td>
      <td>-1.26</td>
      <td>-0.05</td>
      <td>0.25</td>
      <td>0.85</td>
      <td>-1.26</td>
      <td>-1.02</td>
    </tr>
    <tr>
      <th>1951</th>
      <td>0.08</td>
      <td>0.70</td>
      <td>-1.02</td>
      <td>-0.22</td>
      <td>-0.59</td>
      <td>-1.64</td>
      <td>1.37</td>
      <td>-0.22</td>
      <td>-1.36</td>
      <td>1.87</td>
      <td>-0.39</td>
      <td>1.32</td>
    </tr>
    <tr>
      <th>1952</th>
      <td>0.93</td>
      <td>-0.83</td>
      <td>-1.49</td>
      <td>1.01</td>
      <td>-1.12</td>
      <td>-0.40</td>
      <td>-0.09</td>
      <td>-0.28</td>
      <td>-0.54</td>
      <td>-0.73</td>
      <td>-1.13</td>
      <td>-0.43</td>
    </tr>
    <tr>
      <th>1953</th>
      <td>0.33</td>
      <td>-0.49</td>
      <td>-0.04</td>
      <td>-1.67</td>
      <td>-0.66</td>
      <td>1.09</td>
      <td>0.40</td>
      <td>-0.71</td>
      <td>-0.35</td>
      <td>1.32</td>
      <td>1.04</td>
      <td>-0.47</td>
    </tr>
    <tr>
      <th>1954</th>
      <td>0.37</td>
      <td>0.74</td>
      <td>-0.83</td>
      <td>1.34</td>
      <td>-0.09</td>
      <td>-0.25</td>
      <td>-0.60</td>
      <td>-1.90</td>
      <td>-0.44</td>
      <td>0.60</td>
      <td>0.40</td>
      <td>0.69</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>1.34</td>
      <td>1.26</td>
      <td>1.01</td>
      <td>-1.02</td>
      <td>-0.41</td>
      <td>-0.15</td>
      <td>-1.23</td>
      <td>0.12</td>
      <td>0.98</td>
      <td>-0.65</td>
      <td>2.54</td>
      <td>-0.30</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>-1.11</td>
      <td>0.14</td>
      <td>0.73</td>
      <td>-1.43</td>
      <td>-1.24</td>
      <td>0.77</td>
      <td>0.03</td>
      <td>-0.28</td>
      <td>-0.21</td>
      <td>-2.29</td>
      <td>-0.18</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>1.08</td>
      <td>1.68</td>
      <td>0.77</td>
      <td>-0.36</td>
      <td>0.71</td>
      <td>-0.12</td>
      <td>-0.09</td>
      <td>1.47</td>
      <td>-1.61</td>
      <td>-0.72</td>
      <td>0.69</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>1.25</td>
      <td>0.92</td>
      <td>-1.11</td>
      <td>-0.63</td>
      <td>0.39</td>
      <td>-0.58</td>
      <td>-2.17</td>
      <td>-1.16</td>
      <td>-0.44</td>
      <td>-2.03</td>
      <td>-0.32</td>
      <td>1.94</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>0.21</td>
      <td>1.09</td>
      <td>-0.21</td>
      <td>-0.78</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>75 rows × 12 columns</p>
</div></div></div>
</div>
<p>Here we have a challenge: the data present themselves as a 2-dimensional table, and need to be reshaped into a 1-D series by somehow combining months and years in a sequential fashion. Fear not! <code class="docutils literal notranslate"><span class="pre">Pandas</span></code> can do!</p>
<p>First, we turn the index as a column called Year:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nao</span> <span class="o">=</span> <span class="n">df_nao</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;Year&#39;</span><span class="p">})</span>
<span class="n">df_nao</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Jan</th>
      <th>Feb</th>
      <th>Mar</th>
      <th>Apr</th>
      <th>May</th>
      <th>Jun</th>
      <th>Jul</th>
      <th>Aug</th>
      <th>Sep</th>
      <th>Oct</th>
      <th>Nov</th>
      <th>Dec</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1950</td>
      <td>0.92</td>
      <td>0.40</td>
      <td>-0.36</td>
      <td>0.73</td>
      <td>-0.59</td>
      <td>-0.06</td>
      <td>-1.26</td>
      <td>-0.05</td>
      <td>0.25</td>
      <td>0.85</td>
      <td>-1.26</td>
      <td>-1.02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1951</td>
      <td>0.08</td>
      <td>0.70</td>
      <td>-1.02</td>
      <td>-0.22</td>
      <td>-0.59</td>
      <td>-1.64</td>
      <td>1.37</td>
      <td>-0.22</td>
      <td>-1.36</td>
      <td>1.87</td>
      <td>-0.39</td>
      <td>1.32</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1952</td>
      <td>0.93</td>
      <td>-0.83</td>
      <td>-1.49</td>
      <td>1.01</td>
      <td>-1.12</td>
      <td>-0.40</td>
      <td>-0.09</td>
      <td>-0.28</td>
      <td>-0.54</td>
      <td>-0.73</td>
      <td>-1.13</td>
      <td>-0.43</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1953</td>
      <td>0.33</td>
      <td>-0.49</td>
      <td>-0.04</td>
      <td>-1.67</td>
      <td>-0.66</td>
      <td>1.09</td>
      <td>0.40</td>
      <td>-0.71</td>
      <td>-0.35</td>
      <td>1.32</td>
      <td>1.04</td>
      <td>-0.47</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1954</td>
      <td>0.37</td>
      <td>0.74</td>
      <td>-0.83</td>
      <td>1.34</td>
      <td>-0.09</td>
      <td>-0.25</td>
      <td>-0.60</td>
      <td>-1.90</td>
      <td>-0.44</td>
      <td>0.60</td>
      <td>0.40</td>
      <td>0.69</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>70</th>
      <td>2020</td>
      <td>1.34</td>
      <td>1.26</td>
      <td>1.01</td>
      <td>-1.02</td>
      <td>-0.41</td>
      <td>-0.15</td>
      <td>-1.23</td>
      <td>0.12</td>
      <td>0.98</td>
      <td>-0.65</td>
      <td>2.54</td>
      <td>-0.30</td>
    </tr>
    <tr>
      <th>71</th>
      <td>2021</td>
      <td>-1.11</td>
      <td>0.14</td>
      <td>0.73</td>
      <td>-1.43</td>
      <td>-1.24</td>
      <td>0.77</td>
      <td>0.03</td>
      <td>-0.28</td>
      <td>-0.21</td>
      <td>-2.29</td>
      <td>-0.18</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>72</th>
      <td>2022</td>
      <td>1.08</td>
      <td>1.68</td>
      <td>0.77</td>
      <td>-0.36</td>
      <td>0.71</td>
      <td>-0.12</td>
      <td>-0.09</td>
      <td>1.47</td>
      <td>-1.61</td>
      <td>-0.72</td>
      <td>0.69</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>73</th>
      <td>2023</td>
      <td>1.25</td>
      <td>0.92</td>
      <td>-1.11</td>
      <td>-0.63</td>
      <td>0.39</td>
      <td>-0.58</td>
      <td>-2.17</td>
      <td>-1.16</td>
      <td>-0.44</td>
      <td>-2.03</td>
      <td>-0.32</td>
      <td>1.94</td>
    </tr>
    <tr>
      <th>74</th>
      <td>2024</td>
      <td>0.21</td>
      <td>1.09</td>
      <td>-0.21</td>
      <td>-0.78</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>75 rows × 13 columns</p>
</div></div></div>
</div>
<p>Next, we invoke <code class="docutils literal notranslate"><span class="pre">pandas</span></code>’ powerful <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.melt.html">melt</a> function to unpivot the table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nao</span> <span class="o">=</span> <span class="n">df_nao</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;NAO&#39;</span><span class="p">)</span>
<span class="n">df_nao</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Month</th>
      <th>NAO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1950</td>
      <td>Jan</td>
      <td>0.92</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1951</td>
      <td>Jan</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1952</td>
      <td>Jan</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1953</td>
      <td>Jan</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1954</td>
      <td>Jan</td>
      <td>0.37</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>895</th>
      <td>2020</td>
      <td>Dec</td>
      <td>-0.30</td>
    </tr>
    <tr>
      <th>896</th>
      <td>2021</td>
      <td>Dec</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>897</th>
      <td>2022</td>
      <td>Dec</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>898</th>
      <td>2023</td>
      <td>Dec</td>
      <td>1.94</td>
    </tr>
    <tr>
      <th>899</th>
      <td>2024</td>
      <td>Dec</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>900 rows × 3 columns</p>
</div></div></div>
</div>
<p>Next we combine year and month into a date, then ditch the superfluous year and month columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nao</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">df_nao</span>
          <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%b&#39;</span><span class="p">)))[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>             
<span class="n">df_nao</span> <span class="o">=</span> <span class="n">df_nao</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">df_nao</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NAO</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1950-01-01</th>
      <td>0.92</td>
    </tr>
    <tr>
      <th>1950-02-01</th>
      <td>0.40</td>
    </tr>
    <tr>
      <th>1950-03-01</th>
      <td>-0.36</td>
    </tr>
    <tr>
      <th>1950-04-01</th>
      <td>0.73</td>
    </tr>
    <tr>
      <th>1950-05-01</th>
      <td>-0.59</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2024-08-01</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2024-09-01</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2024-10-01</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2024-11-01</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2024-12-01</th>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>900 rows × 1 columns</p>
</div></div></div>
</div>
<p>Note the use of a <a class="reference external" href="https://www.geeksforgeeks.org/python-lambda-anonymous-functions-filter-map-reduce/">lambda function</a> to rework month and year on the fly. Now we have a proper dataframe with a time axis that is a proper <a class="reference external" href="https://docs.python.org/3/library/datetime.html">datetime object</a>, which <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> will know what do to with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nao</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;1950-01-01&#39;, &#39;1950-02-01&#39;, &#39;1950-03-01&#39;, &#39;1950-04-01&#39;,
               &#39;1950-05-01&#39;, &#39;1950-06-01&#39;, &#39;1950-07-01&#39;, &#39;1950-08-01&#39;,
               &#39;1950-09-01&#39;, &#39;1950-10-01&#39;,
               ...
               &#39;2024-03-01&#39;, &#39;2024-04-01&#39;, &#39;2024-05-01&#39;, &#39;2024-06-01&#39;,
               &#39;2024-07-01&#39;, &#39;2024-08-01&#39;, &#39;2024-09-01&#39;, &#39;2024-10-01&#39;,
               &#39;2024-11-01&#39;, &#39;2024-12-01&#39;],
              dtype=&#39;datetime64[ns]&#39;, name=&#39;date&#39;, length=900, freq=None)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nao</span><span class="p">[</span><span class="s1">&#39;NAO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../_images/0a7d4b088677e53860f04abf6c2795a5163e316ec3566723fe88c1a6def72510.png" src="../_images/0a7d4b088677e53860f04abf6c2795a5163e316ec3566723fe88c1a6def72510.png" />
</div>
</div>
<p>Now all we need to do to turn this into a <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> Series object is to sprinkle a little metadata.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;time_unit&#39;</span><span class="p">:</span> <span class="s1">&#39;years CE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;time_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="s1">&#39;value_name&#39;</span><span class="p">:</span> <span class="s1">&#39;NAO&#39;</span><span class="p">,</span>
        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;North Atlantic Oscillation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;archiveType&#39;</span><span class="p">:</span> <span class="s1">&#39;Instrumental&#39;</span><span class="p">,</span>
        <span class="s1">&#39;importedFrom&#39;</span><span class="p">:</span> <span class="s1">&#39;NOAA/NCEI&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">NAO</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df_nao</span><span class="p">[</span><span class="s1">&#39;NAO&#39;</span><span class="p">],</span><span class="n">metadata</span><span class="p">)</span>
<span class="n">NAO</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Time [years CE]&#39;, ylabel=&#39;NAO&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/2f2928ca6b8637730e8e1a554381e559e9a3485fca171f7a983ebe4aac6b8c7c.png" src="../_images/2f2928ca6b8637730e8e1a554381e559e9a3485fca171f7a983ebe4aac6b8c7c.png" />
</div>
</div>
<p>It turns out that this verison has gaps, which we need to fill by interpolation so other methods work properly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NAOi</span> <span class="o">=</span> <span class="n">NAO</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">NAO</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">NAOi</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;interpolated&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;Time [years CE]&#39;, ylabel=&#39;NAO&#39;&gt;
</pre></div>
</div>
<img alt="../_images/08436a68c270fa715b425fe5ea209171e301d0cab677da33e701726c9da61b79.png" src="../_images/08436a68c270fa715b425fe5ea209171e301d0cab677da33e701726c9da61b79.png" />
</div>
</div>
<p>Let us now look at SOI and NAO side by side:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ms</span> <span class="o">=</span> <span class="n">NAOi</span> <span class="o">&amp;</span> <span class="n">SOI</span>
<span class="n">ms</span><span class="o">.</span><span class="n">stackplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 640x480 with 3 Axes&gt;,
 {0: &lt;Axes: ylabel=&#39;NAO&#39;&gt;,
  1: &lt;Axes: ylabel=&#39;SOI [mb]&#39;&gt;,
  &#39;x_axis&#39;: &lt;Axes: xlabel=&#39;Time [year C.E.]&#39;&gt;})
</pre></div>
</div>
<img alt="../_images/cf44e6e13c4cd9e3309a51efa0cb1d193fd632e536cd57d3243f3e22109621bb.png" src="../_images/cf44e6e13c4cd9e3309a51efa0cb1d193fd632e536cd57d3243f3e22109621bb.png" />
</div>
</div>
<p>The series have comparable length, and SOI seems, by eye, to dislay stronger internnual variability. We could confirm this by spectral analysis, but this is not the object of this tutorial. Let’s dive into exploring their relationship, if any.</p>
</section>
<section id="measuring-association">
<h2>Measuring Association<a class="headerlink" href="#measuring-association" title="Link to this heading">#</a></h2>
<p>Here we will use the <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/core/api.html#pyleoclim.core.series.Series.correlation">Pyleoclim’s correlation() function</a> to measure association between SOI and NAO.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_base</span> <span class="o">=</span> <span class="n">SOI</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">NAOi</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;built-in&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_base</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
    0.0011608       0.97  False
</pre></div>
</div>
</div>
</div>
<p>We see a very small correlation, with (under this particular test) a large p-value that does not allow to claim that this correlation is significant (i.e. remarkable) in any way. At this point you should be asking yourself what the underlying null hypothesis is. <a class="reference external" href="https://online.stat.psu.edu/stat501/lesson/1/1.9">This link</a> might be helpful in recalling that, and the assumptions of this standard test.</p>
<p>Note that the function allows to use a bunch of <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/stats.html#association-correlation-tests">different statistics to measure association</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pearsonr&#39;</span><span class="p">,</span><span class="s1">&#39;spearmanr&#39;</span><span class="p">,</span><span class="s1">&#39;pointbiserialr&#39;</span><span class="p">,</span><span class="s1">&#39;kendalltau&#39;</span><span class="p">,</span><span class="s1">&#39;weightedtau&#39;</span><span class="p">]:</span>
     <span class="n">corr</span> <span class="o">=</span> <span class="n">SOI</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">NAOi</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s1">(NAO,SOI)=</span><span class="si">{</span><span class="n">corr</span><span class="o">.</span><span class="n">r</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, p=</span><span class="si">{</span><span class="n">corr</span><span class="o">.</span><span class="n">p</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:   0%|                                                                | 0/200 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:  76%|███████████████████████████████████████▌            | 152/200 [00:00&lt;00:00, 1518.65it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|████████████████████████████████████████████████████| 200/200 [00:00&lt;00:00, 1521.79it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pearsonr(NAO,SOI)=0.001, p=0.980
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:   0%|                                                                | 0/200 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|████████████████████████████████████████████████████| 200/200 [00:00&lt;00:00, 2161.72it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>spearmanr(NAO,SOI)=-0.002, p=0.985
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:   0%|                                                                | 0/200 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:  78%|████████████████████████████████████████▊           | 157/200 [00:00&lt;00:00, 1567.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|████████████████████████████████████████████████████| 200/200 [00:00&lt;00:00, 1559.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pointbiserialr(NAO,SOI)=0.001, p=0.980
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:   0%|                                                                | 0/200 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|████████████████████████████████████████████████████| 200/200 [00:00&lt;00:00, 2401.65it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>kendalltau(NAO,SOI)=-0.001, p=0.975
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:   0%|                                                                | 0/200 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:  22%|███████████▉                                          | 44/200 [00:00&lt;00:00, 439.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:  44%|███████████████████████▊                              | 88/200 [00:00&lt;00:00, 438.21it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:  66%|██████████████████████████████████▉                  | 132/200 [00:00&lt;00:00, 434.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs:  88%|██████████████████████████████████████████████▋      | 176/200 [00:00&lt;00:00, 432.74it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|█████████████████████████████████████████████████████| 200/200 [00:00&lt;00:00, 433.43it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>weightedtau(NAO,SOI)=-0.035, p=0.705
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>We see that no matter which way we slice it, we get very small numbers, which appear insignificant with respect to the default test.</p>
</section>
<section id="spurious-correlations">
<h2>Spurious Correlations<a class="headerlink" href="#spurious-correlations" title="Link to this heading">#</a></h2>
<p>In the geosciences, there are two process that might artificially increase correlations between otherwise unrelated variables</p>
<ol class="arabic simple">
<li><p>smoothing</p></li>
<li><p>common trends</p></li>
</ol>
<section id="smoothing-enhanced-correlations">
<h3>Smoothing-enhanced correlations<a class="headerlink" href="#smoothing-enhanced-correlations" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ms_md</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;butterworth&#39;</span><span class="p">,</span><span class="n">cutoff_scale</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
<span class="n">ms_md</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Time [year C.E.]&#39;, ylabel=&#39;value&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/902ccc23f2306deff2e755e8e5f4b017d034db90aba6099b5881379fda445aaf.png" src="../_images/902ccc23f2306deff2e755e8e5f4b017d034db90aba6099b5881379fda445aaf.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_md</span><span class="o">=</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;built-in&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_md</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation  p-value    signif. (α: 0.05)
-------------  ---------  -------------------
     0.306343  &lt; 1e-18    True
</pre></div>
</div>
</div>
</div>
<p>We see that we sufficient smoothing, we have increased the correlation to a point that it is now highly significant (note the infinitesimal p-value). Bu BEWARE! The built-in test for Pearson’s correlation, as recalled above, assumes that the data are IID: independent and identically distributed. After smoothing so heavily, neighboring values now resemble each other a lot, so independence is lost (see course notes for more details). So now we need to bring more sophisticated methods to gauge the p-values.
First, let’s use a common analytical approximation to adjust for the loss of degrees of freedom (see course notes). This is coded up in <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> as <code class="docutils literal notranslate"><span class="pre">ttest</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_md_dof</span><span class="o">=</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ttest&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_md_dof</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">corr_md_dof</span><span class="o">=</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ttest&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="n">corr_md_dof</span><span class="p">)</span>

<span class="nn">File ~/Documents/GitHub/Pyleoclim_util/pyleoclim/core/series.py:3552,</span> in <span class="ni">Series.correlation</span><span class="nt">(self, target_series, alpha, statistic, method, number, timespan, settings, seed, common_time_kwargs, mute_pbar)</span>
<span class="g g-Whitespace">   </span><span class="mi">3550</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ttest&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3551</span>     <span class="k">if</span> <span class="n">statistic</span> <span class="o">==</span> <span class="s1">&#39;pearsonr&#39;</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">3552</span>         <span class="n">stat</span><span class="p">,</span> <span class="n">signf</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">corrutils</span><span class="o">.</span><span class="n">corr_ttest</span><span class="p">(</span><span class="n">ts0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ts1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3553</span>         <span class="n">signif</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">signf</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3554</span>     <span class="k">else</span><span class="p">:</span>

<span class="nn">File ~/Documents/GitHub/Pyleoclim_util/pyleoclim/utils/correlation.py:234,</span> in <span class="ni">corr_ttest</span><span class="nt">(y1, y2, alpha)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> <span class="n">Ney2</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">g2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">g2</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">233</span> <span class="n">Ne</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mstats</span><span class="o">.</span><span class="n">gmean</span><span class="p">([</span><span class="n">Ney1</span><span class="o">+</span><span class="n">Ney2</span><span class="p">])</span>
<span class="ne">--&gt; </span><span class="mi">234</span> <span class="k">assert</span> <span class="n">Ne</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Too few effective d.o.f. to apply this method!&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">236</span> <span class="n">df</span> <span class="o">=</span> <span class="n">Ne</span> <span class="o">-</span> <span class="mi">2</span>
<span class="g g-Whitespace">    </span><span class="mi">237</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="ne">AssertionError</span>: Too few effective d.o.f. to apply this method!
</pre></div>
</div>
</div>
</div>
<p>That didn’t work! As the error message implies, the smoothing has lowered the effective degrees of freedom to such an extent this method won’t work. Then let’s use a parametric Monte Carlo test:  AR(1) benchmarks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_md_ar1</span><span class="o">=</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1sim&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">222</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_md_ar1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|██████████| 5000/5000 [00:03&lt;00:00, 1487.20it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.306343       0.35  False
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>The correlation has not changed, but see what happened to the p-value! We can actually quantify this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_md_ar1</span><span class="o">.</span><span class="n">p</span><span class="o">/</span><span class="n">corr_md</span><span class="o">.</span><span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.8258770939061737e+18
</pre></div>
</div>
</div>
</div>
<p>This is how much larger the p-value is under this test! So we got from highly significant to insignificant. Would we have found the same with the non-parametric Monte Carlo test (phase-randomization)?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_md_pr</span><span class="o">=</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">ms_md</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;phaseran&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">222</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr_md_pr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|██████████| 5000/5000 [00:03&lt;00:00, 1434.84it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
     0.306343       0.02  True
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>In this case, the two methods disagree, and phase-randomization appears more lenient. Disagreements between methods are frequent when there are relatively few degrees of freedom, and are cause for caution.</p>
<p><strong>Take-home message: beware the effect of smoothing on the degrees of freedom, and assessments of significance.</strong></p>
</section>
<section id="trend-enhanced-correlations">
<h3>Trend-enhanced correlations<a class="headerlink" href="#trend-enhanced-correlations" title="Link to this heading">#</a></h3>
<p>Now we look at a slightly different issue: how the presence of common trends may make otherwise unrelated timeseries appear artificially related. First, let’s apply the <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/core/api.html#pyleoclim.core.multipleseries.MultipleSeries.common_time">common_time</a> method to obtain a common time vector to both series, from which we’ll construct the trend:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msc</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">()</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">msc</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="c1"># would get the same answer with msc.series_list[`].time</span>
</pre></div>
</div>
</div>
</div>
<p>The baseline trend will look something like this, which we’ll superimpose on the NAO and SOI indices, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trend</span> <span class="o">=</span> <span class="p">(</span><span class="n">tc</span><span class="o">-</span><span class="n">tc</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">tc</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span> <span class="c1"># create trend as a NumPy array</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="n">trend</span><span class="p">)</span> <span class="c1"># plot it</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1406ca890&gt;]
</pre></div>
</div>
<img alt="../_images/9fd22fa7783bcb093fa27dc3f37da9e88684ff347441512643c5f23794853e2d.png" src="../_images/9fd22fa7783bcb093fa27dc3f37da9e88684ff347441512643c5f23794853e2d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scales</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;built-in&#39;</span><span class="p">,</span><span class="s1">&#39;ttest&#39;</span><span class="p">,</span><span class="s1">&#39;ar1sim&#39;</span><span class="p">,</span><span class="s1">&#39;phaseran&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scales</span><span class="p">:</span>
        <span class="n">scaled_trend</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">trend</span> <span class="c1"># create trend as a NumPy array</span>
        <span class="n">nao_t</span> <span class="o">=</span> <span class="n">msc</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># create copy of the NAO series</span>
        <span class="n">nao_t</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="n">scaled_trend</span> <span class="c1"># add trend</span>
        <span class="n">soi_t</span> <span class="o">=</span> <span class="n">msc</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># create copy of the SOI series</span>
        <span class="n">soi_t</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="n">scaled_trend</span> <span class="c1"># add trend</span>
        <span class="n">corr_t</span> <span class="o">=</span> <span class="n">nao_t</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">soi_t</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scale = </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">, using </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> method</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">corr_t</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale = 0.5, using built-in method

  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
    0.0279778       0.42  False

Scale = 1, using built-in method

  correlation  p-value    signif. (α: 0.05)
-------------  ---------  -------------------
    0.0924265  &lt; 1e-2     True

Scale = 2, using built-in method

  correlation  p-value    signif. (α: 0.05)
-------------  ---------  -------------------
     0.277871  &lt; 1e-15    True

Scale = 0.5, using ttest method

  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
    0.0279778       0.46  False

Scale = 1, using ttest method

  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
    0.0924265       0.02  True

Scale = 2, using ttest method

  correlation  p-value    signif. (α: 0.05)
-------------  ---------  -------------------
     0.277871  &lt; 1e-12    True
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|██████████| 1000/1000 [00:00&lt;00:00, 1523.83it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale = 0.5, using ar1sim method

  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
    0.0279778       0.44  False
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|██████████| 1000/1000 [00:00&lt;00:00, 1531.31it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale = 1, using ar1sim method

  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
    0.0924265       0.03  True
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|██████████| 1000/1000 [00:00&lt;00:00, 1537.74it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale = 2, using ar1sim method

  correlation  p-value    signif. (α: 0.05)
-------------  ---------  -------------------
     0.277871  &lt; 1e-6     True
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|██████████| 1000/1000 [00:00&lt;00:00, 1452.27it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale = 0.5, using phaseran method

  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
    0.0279778       0.55  False
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|██████████| 1000/1000 [00:00&lt;00:00, 1513.72it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale = 1, using phaseran method

  correlation    p-value  signif. (α: 0.05)
-------------  ---------  -------------------
    0.0924265       0.15  False
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating association on surrogate pairs: 100%|██████████| 1000/1000 [00:00&lt;00:00, 1389.75it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale = 2, using phaseran method

  correlation  p-value    signif. (α: 0.05)
-------------  ---------  -------------------
     0.277871  &lt; 1e-2     True
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>As we dial up the amplitude of the trend (1/2, 1, 2x the original trend), we see that the correlation goes from 0.028, to 0.09, to 0.28. The built-in method, being easily fooled, declares all three as significant. The other methods are more resilient, but when the trend is large enough (2), all of them call the correlation significant.  The t-test with adjusted degrees of freedom (DOFs) gives downright counterinuitive results: it calls 0.028 significant,  0.09 insignificant, and 0.28 significant again. In this case, phase randomization is the most conservative. This is why it is the default method in <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code>.</p>
<p><strong>Take-home message: common trends can easily create the appearance of correlations (see <a class="reference external" href="https://www.tylervigen.com/spurious-correlations">Tyler Vigen’s excellent website</a>) and really complicate assessments of significance.</strong> If the trend is not relevant to your question, we recommend removing it prior to computing correlations, e.g. using <code class="docutils literal notranslate"><span class="pre">Pyleoclim's</span></code> <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/core/api.html#pyleoclim.core.series.Series.detrend">detrend()</a>.</p>
</section>
</section>
<section id="takeways">
<h2>Takeways<a class="headerlink" href="#takeways" title="Link to this heading">#</a></h2>
<p>Not only is correlation not indicative of causation, but spurious correlations abound, often driven by smoothing, trends, or short sample sizes. Some null hypotheses are more stringent than others, but the built-in one nearly always assumed IID data, which is hardly ever verified in the geosciences. Make you carefully match your null hypothesis to your data/problem.</p>
<p>If if it causality you are after, more advanced tools are available, like <a class="reference external" href="https://sugiharalab.github.io/EDM_Documentation/">Empirical Dynamical Modeling</a>. It is well worth a dive into the underlying theory, but it is undoubtedly more complex.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "pyleo"
        },
        kernelOptions: {
            name: "pyleo",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'pyleo'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="signal_processing.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 2: Signal Processing</p>
      </div>
    </a>
    <a class="right-next"
       href="Spectral_Analysis_Rio_Grande.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 4: Spectral Analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling">Data Wrangling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-association">Measuring Association</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spurious-correlations">Spurious Correlations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing-enhanced-correlations">Smoothing-enhanced correlations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trend-enhanced-correlations">Trend-enhanced correlations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#takeways">Takeways</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Julien Emile-Geay
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>