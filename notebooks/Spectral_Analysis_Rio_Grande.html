
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Chapter 4: Spectral Analysis &#8212; PyRATES practicums with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/Spectral_Analysis_Rio_Grande';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 5: Wavelets and Coherency" href="wavelets%26coherence.html" />
    <link rel="prev" title="Chapter 3: Measures of association" href="Association.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Pyrateslogo.png" class="logo__image only-light" alt="PyRATES practicums with Python - Home"/>
    <script>document.write(`<img src="../_static/Pyrateslogo.png" class="logo__image only-dark" alt="PyRATES practicums with Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    PyRATES: Python and R Analysis of Time Series
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Intro_Mauna_Loa.html">Chapter 1: Introduction to Timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="signal_processing.html">Chapter 2: Signal Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Association.html">Chapter 3: Measures of association</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 4: Spectral Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="wavelets%26coherence.html">Chapter 5: Wavelets and Coherency</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/LinkedEarth/PyRATES_practicums_py/main?urlpath=tree/jbook/notebooks/Spectral_Analysis_Rio_Grande.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LinkedEarth/PyRATES_practicums_py" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LinkedEarth/PyRATES_practicums_py/issues/new?title=Issue%20on%20page%20%2Fnotebooks/Spectral_Analysis_Rio_Grande.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/Spectral_Analysis_Rio_Grande.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 4: Spectral Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#packages">Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling">Data Wrangling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conversion-to-pyleoclim">Conversion to Pyleoclim</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gap-free-analysis">Gap-free analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-scaling-behavior">Estimation of scaling behavior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gap-tolerant-spectral-analysis">Gap-tolerant spectral analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#failed-ssa-attempt">FAILED SSA attempt</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <img src='http://linked.earth/FROGS/images/Pyrateslogo.jpg' width="400">
<section class="tex2jax_ignore mathjax_ignore" id="chapter-4-spectral-analysis">
<h1>Chapter 4: Spectral Analysis<a class="headerlink" href="#chapter-4-spectral-analysis" title="Link to this heading">#</a></h1>
<p>by <a class="reference external" href="https://orcid.org/0000-0001-5920-4751">Julien Emile-Geay</a>, University of Southern California</p>
<p>Recall that in spectral analysis we step into a “bizarro world”, switching from the time domain to the frequency domain. There,  two essential features are of interest: peaks, and background. In this tutorial, we will perform spectral analysis on Rio Grande streamflow, and see if we can learn anything interesting about it in this way.</p>
<section id="packages">
<h2>Packages<a class="headerlink" href="#packages" title="Link to this heading">#</a></h2>
<p>In addition to the Scientific Python stack (numpy, scipy, matplotlib), this tutorial showcases:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/">pandas</a></p></li>
<li><p><a class="reference external" href="http://linked.earth/PyleoTutorials/">Pyleoclim</a> was designed for the analysis of paleoclimate timeseries, but we show here that is perfectly able to deal with any timeseries.</p></li>
</ul>
</section>
<section id="dataset">
<h2>Dataset<a class="headerlink" href="#dataset" title="Link to this heading">#</a></h2>
<p>We will be looking at the daily discharge of the Rio Grande, which has been measured at
Embudo, NM since 1889. The data and their associated metadata may be retrieved from
the <a class="reference external" href="https://waterdata.usgs.gov/nwis/dv?cb_00060=on&amp;amp;format=html&amp;amp;site_no=08279500&amp;amp;legacy=&amp;amp;referred_module=sw&amp;amp;period=&amp;amp;begin_date=2023-05-21&amp;amp;end_date=2024-05-20">USGS website</a>. Let’s load them and have a look:</p>
</section>
<section id="data-wrangling">
<h2>Data Wrangling<a class="headerlink" href="#data-wrangling" title="Link to this heading">#</a></h2>
<p>Once again we use pandas to load the data from the web. We need to give it a little help by specifying the column names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://waterdata.usgs.gov/nwis/dv?cb_00060=on&amp;format=rdb&amp;site_no=08279500&amp;legacy=&amp;referred_module=sw&amp;period=&amp;begin_date=1889-01-01&amp;end_date=2024-05-20&#39;</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;agency&#39;</span><span class="p">,</span> <span class="s1">&#39;site_no&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span><span class="s1">&#39;discharge (cf/s)&#39;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>agency</th>
      <th>site_no</th>
      <th>datetime</th>
      <th>discharge (cf/s)</th>
      <th>code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>USGS</td>
      <td>8279500</td>
      <td>1889-01-01</td>
      <td>398.0</td>
      <td>A</td>
    </tr>
    <tr>
      <th>1</th>
      <td>USGS</td>
      <td>8279500</td>
      <td>1889-01-02</td>
      <td>385.0</td>
      <td>A</td>
    </tr>
    <tr>
      <th>2</th>
      <td>USGS</td>
      <td>8279500</td>
      <td>1889-01-03</td>
      <td>395.0</td>
      <td>A</td>
    </tr>
    <tr>
      <th>3</th>
      <td>USGS</td>
      <td>8279500</td>
      <td>1889-01-04</td>
      <td>400.0</td>
      <td>A</td>
    </tr>
    <tr>
      <th>4</th>
      <td>USGS</td>
      <td>8279500</td>
      <td>1889-01-05</td>
      <td>413.0</td>
      <td>A</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>the fourth column is the one we want, and we’ll want to use the datetime column as a index for pandas. Let us create a new pandas Series from this dataframe, with this new and improved index:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
<span class="n">dis</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;discharge (cf/s)&#39;</span><span class="p">]</span>
<span class="n">dis</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">date</span>
<span class="n">dis</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>datetime
1889-01-01     398.0
1889-01-02     385.0
1889-01-03     395.0
1889-01-04     400.0
1889-01-05     413.0
               ...  
2024-05-16    1000.0
2024-05-17    1020.0
2024-05-18    1030.0
2024-05-19    1150.0
2024-05-20    1280.0
Name: discharge (cf/s), Length: 49448, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>First, let us inspect the distribution of values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dis</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/38552209e66f76bc9fc0157881524bfebae32c1d4aacb452d4a42a8b23478e20.png" src="../_images/38552209e66f76bc9fc0157881524bfebae32c1d4aacb452d4a42a8b23478e20.png" />
</div>
</div>
<p>Like many other variables, streamflow is <strong>positively skewed</strong>: the distribution is asymmetric, with most values near zero and few instances of very high streamflow. Now let’s inspect the temporal behavior:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dis</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;datetime&#39;&gt;
</pre></div>
</div>
<img alt="../_images/8fc8320b95021491a6ce568af3f36e521eb3db99597863d2a2bb796b52b9ac2c.png" src="../_images/8fc8320b95021491a6ce568af3f36e521eb3db99597863d2a2bb796b52b9ac2c.png" />
</div>
</div>
<p>We see that there is a large gap in the dataset, which could complicate analysis. Overall, a significant percentage of values are missing (coded as NaNs). We can estimate that percentage as follows, using pandas’s <code class="docutils literal notranslate"><span class="pre">isna()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dis</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dis</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.651431807150947
</pre></div>
</div>
</div>
</div>
<p>This is no problem for Pyleoclim, which is built to handle missing values, even large gaps like the one in the 1910s.
However, daily data are a lot! Let’s resample to a monthly interval to lighten up calculations a bit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dis_c</span> <span class="o">=</span> <span class="n">dis</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">dis_c</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;datetime&#39;&gt;
</pre></div>
</div>
<img alt="../_images/b6fe8e2c2541e5b8aefa95de030f47d1613dabb250859e98d601906cfdedc3e9.png" src="../_images/b6fe8e2c2541e5b8aefa95de030f47d1613dabb250859e98d601906cfdedc3e9.png" />
</div>
</div>
<section id="conversion-to-pyleoclim">
<h3>Conversion to Pyleoclim<a class="headerlink" href="#conversion-to-pyleoclim" title="Link to this heading">#</a></h3>
<p>Having loaded and inspected the data, we are ready to start analyzing it. We do so via the <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> package.
Here we show one way to ingest the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> Series object into a <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> Series object. In addition to <code class="docutils literal notranslate"><span class="pre">dis_c</span></code>, we need a little bit of metadata:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;time_unit&#39;</span><span class="p">:</span> <span class="s1">&#39;years CE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;time_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="s1">&#39;value_unit&#39;</span><span class="p">:</span> <span class="s1">&#39;cf/s&#39;</span><span class="p">,</span>
        <span class="s1">&#39;value_name&#39;</span><span class="p">:</span> <span class="s1">&#39;discharge&#39;</span><span class="p">,</span>
        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Rio Grande at Embudo, NM (monthly)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;archiveType&#39;</span><span class="p">:</span> <span class="s1">&#39;Instrumental&#39;</span><span class="p">,</span>
        <span class="s1">&#39;importedFrom&#39;</span><span class="p">:</span> <span class="s1">&#39;USGS&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyleoclim</span> <span class="k">as</span> <span class="nn">pyleo</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">ser</span><span class="o">=</span><span class="n">dis_c</span><span class="p">,</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
<span class="n">ts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;archiveType&#39;: &#39;Instrumental&#39;,
 &#39;importedFrom&#39;: &#39;USGS&#39;,
 &#39;label&#39;: &#39;Rio Grande at Embudo, NM (monthly)&#39;}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
Time [years CE]
1889.086207     432.548387
1889.162869     472.607143
1889.247744     781.483871
1889.329881    2259.666667
1889.414756    3430.645161
                  ...     
2024.084299     413.967742
2024.163699     494.068966
2024.248574     573.451613
2024.330711     875.900000
2024.415586    1190.000000
Name: discharge [cf/s], Length: 1625, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Time [years CE]&#39;, ylabel=&#39;discharge [cf/s]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/84e211613e6d3a39a100b1b278d89cb2ddbd80d3390309a547ed787c02a81dcc.png" src="../_images/84e211613e6d3a39a100b1b278d89cb2ddbd80d3390309a547ed787c02a81dcc.png" />
</div>
</div>
<p>There seem to be two segments. Let’s see what Pyleoclim makes of them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ms</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">segment</span><span class="p">()</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f2228b76eb8207b09a9ecbbbf33dc5ad928d9cee66f35ae192429fabf4706083.png" src="../_images/f2228b76eb8207b09a9ecbbbf33dc5ad928d9cee66f35ae192429fabf4706083.png" />
<img alt="../_images/a7b5aefa84ed43de3626fb38ee3d8c21f493f1c6a9ec2865509805b3f043642e.png" src="../_images/a7b5aefa84ed43de3626fb38ee3d8c21f493f1c6a9ec2865509805b3f043642e.png" />
</div>
</div>
<p>Note that despite our monthly resampling, the series are not actually evenly spaced:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_late</span><span class="o">.</span><span class="n">resolution</span><span class="p">()</span><span class="o">.</span><span class="n">dashboard</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ts_late</span><span class="o">.</span><span class="n">resolution</span><span class="p">()</span><span class="o">.</span><span class="n">dashboard</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;ts_late&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Recall that most timeseries methods assume <strong>even spacing</strong> (no gaps). We have two options: apply dedicated gap-tolerant spectral methods, or find away to fill the gaps so that we can apply classical techniques that assume even spacing.</p>
</section>
</section>
<section id="gap-free-analysis">
<h2>Gap-free analysis<a class="headerlink" href="#gap-free-analysis" title="Link to this heading">#</a></h2>
<p>Let us focus on the last segment for our analysis. Let’s use the <code class="docutils literal notranslate"><span class="pre">spectral()</span></code> method and select the multi-taper method (MTM)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_late</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">psd</span> <span class="o">=</span> <span class="n">ts_late</span><span class="o">.</span><span class="n">standardize</span><span class="p">()</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mtm&#39;</span><span class="p">)</span>
<span class="n">psd</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">213</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">ts_late</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">ts_late</span><span class="o">.</span><span class="n">standardize</span><span class="p">()</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mtm&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">psd</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="nn">File ~/Documents/GitHub/Pyleoclim_util/pyleoclim/core/series.py:2998,</span> in <span class="ni">Series.spectral</span><span class="nt">(self, method, freq, freq_kwargs, settings, label, scalogram, verbose)</span>
<span class="g g-Whitespace">   </span><span class="mi">2990</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">Results</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">scalogram</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">coi</span><span class="o">=</span><span class="n">scalogram</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2991</span>                   <span class="n">freq</span><span class="o">=</span><span class="n">scalogram</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">scalogram</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2992</span>                   <span class="n">scale</span><span class="o">=</span><span class="n">scalogram</span><span class="o">.</span><span class="n">wave_args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">   </span><span class="mi">2993</span>                   <span class="n">mother</span><span class="o">=</span><span class="n">scalogram</span><span class="o">.</span><span class="n">wave_args</span><span class="p">[</span><span class="s1">&#39;mother&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">   </span><span class="mi">2994</span>                   <span class="n">param</span><span class="o">=</span><span class="n">scalogram</span><span class="o">.</span><span class="n">wave_args</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">   </span><span class="mi">2995</span>     <span class="n">args</span><span class="p">[</span><span class="s1">&#39;cwt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;cwt_res&#39;</span><span class="p">:</span><span class="n">res</span><span class="p">})</span>
<span class="ne">-&gt; </span><span class="mi">2998</span> <span class="n">spec_res</span> <span class="o">=</span> <span class="n">spec_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
<span class="g g-Whitespace">   </span><span class="mi">2999</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">spec_res</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3000</span>     <span class="n">spec_res</span> <span class="o">=</span> <span class="n">dict2namedtuple</span><span class="p">(</span><span class="n">spec_res</span><span class="p">)</span>

<span class="nn">File ~/Documents/GitHub/Pyleoclim_util/pyleoclim/utils/spectral.py:315,</span> in <span class="ni">mtm</span><span class="nt">(ys, ts, NW, BW, detrend, sg_kwargs, gaussianize, standardize, adaptive, jackknife, low_bias, sides, nfft)</span>
<span class="g g-Whitespace">    </span><span class="mi">313</span> <span class="n">check</span> <span class="o">=</span> <span class="n">is_evenly_spaced</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">314</span> <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">315</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;For the MTM method, data should be evenly spaced&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">316</span> <span class="c1"># preprocessing</span>
<span class="g g-Whitespace">    </span><span class="mi">317</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="n">detrend</span><span class="p">,</span> <span class="n">sg_kwargs</span><span class="o">=</span><span class="n">sg_kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">318</span>            <span class="n">gaussianize</span><span class="o">=</span><span class="n">gaussianize</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="n">standardize</span><span class="p">)</span>

<span class="ne">ValueError</span>: For the MTM method, data should be evenly spaced
</pre></div>
</div>
</div>
</div>
<p>Here we got reprimanded for passing an unevenly-spaced series to a method that expects even spacing. Never mind; we can interpolate to a monthly sampling:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tsi</span> <span class="o">=</span> <span class="n">ts_late</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span> <span class="c1"># note the step of 1/12, as the time has units of years</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ts_late</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">tsi</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;monthly interpolation&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;Time [years CE]&#39;, ylabel=&#39;discharge [cf/s]&#39;&gt;
</pre></div>
</div>
<img alt="../_images/c44523977687c784c14f56cf9d107529a9599865905ffd82d1ca962383f6880d.png" src="../_images/c44523977687c784c14f56cf9d107529a9599865905ffd82d1ca962383f6880d.png" />
</div>
</div>
<p>We can see that the results are very close. Now let us apply MTM to the interpolated series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd_mtm</span> <span class="o">=</span> <span class="n">tsi</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mtm&#39;</span><span class="p">)</span>
<span class="n">psd_mtm</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/4e411c52093cb465a115f972063872a100cb896cf8700c143208d19c0347fdde.png" src="../_images/4e411c52093cb465a115f972063872a100cb896cf8700c143208d19c0347fdde.png" />
</div>
</div>
<p>The prominent feature is a strong annual cycle and higher-order harmonics, super-imposed on a “warm colored” background (i.e. variations at long timescales are larger than variations at short timescales). There are hints of long-term scaling as well, one in the subannual range, and one from period of 1 to 50y.
We may be interested in the shape of this background, and whether it can be fit by one or more power laws.</p>
<p>In addition, we may be interested in interannual (year-to-year) to interdecadal (decade-to-decade) variations in streamflow. We would like to know whether the peak observed around 3-4 years in the plot above is <strong>significant</strong> with respect to a reasonable null.</p>
<p>To do both of these things it would make sense to remove the annual cycle. There are several options to do so:</p>
<ul class="simple">
<li><p>STL decomposition (see Intro notebook)</p></li>
<li><p>calculating and removing the monthly-mean seasonal cycle</p></li>
</ul>
<p>To apply STL, we need to get back into pandas land. Thankfully, <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> has utilities that make interconversion with pandas a breeze. Let’s return to our monthly-sampled dataframe, but only select the indices that correspond to the late segment identified by <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dis_late</span> <span class="o">=</span> <span class="n">dis_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dis_c</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">ts_late</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span> <span class="c1"># select the last segment of the dataframe</span>
<span class="n">dis_late</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;datetime&#39;&gt;
</pre></div>
</div>
<img alt="../_images/b00f24aa6292140e43b0dd6e5e06f4225d18e0f4dc038d32faccd7cd735f1e48.png" src="../_images/b00f24aa6292140e43b0dd6e5e06f4225d18e0f4dc038d32faccd7cd735f1e48.png" />
</div>
</div>
<p>Now, because of the positive skew mentioned above, it turns out that the STL decomposition has trouble with this dataset. Instead, we can use the <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/core/api.html#pyleoclim.core.series.Series.gaussianize">gaussianize()</a> to map this dataset to a standard normal. There are applications for which this would be undesirable, but for this purpose it is good:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_lg</span> <span class="o">=</span> <span class="n">tsi</span><span class="o">.</span><span class="n">gaussianize</span><span class="p">()</span>
<span class="n">ts_lg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Time [years CE]&#39;, ylabel=&#39;discharge [cf/s]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/86d8ee2414057bac70f9b205bbb1df5be1bdbcdc65051a3919e78f486e395707.png" src="../_images/86d8ee2414057bac70f9b205bbb1df5be1bdbcdc65051a3919e78f486e395707.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_lg</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mtm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/b660ed18f6b13695ed4e6588ccbff81096f3c65906258f32ca49d01990bec12e.png" src="../_images/b660ed18f6b13695ed4e6588ccbff81096f3c65906258f32ca49d01990bec12e.png" />
</div>
</div>
<p>We see that the spectrum is nearly unchanged, but now we can apply STL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="kn">import</span> <span class="n">STL</span>
<span class="n">dis_m</span> <span class="o">=</span> <span class="n">tsi</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">nearest</span><span class="p">()</span>
<span class="n">stl</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">dis_m</span><span class="p">,</span> <span class="n">seasonal</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">stl_res</span> <span class="o">=</span> <span class="n">stl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">stl_res</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/226a3246060830e49d63bc2044a5e3df181b3e91cfe451f35b1b459ed458c602.png" src="../_images/226a3246060830e49d63bc2044a5e3df181b3e91cfe451f35b1b459ed458c602.png" />
</div>
</div>
<p>Let’s turn this into a <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> series and apply spectral analysis</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anom</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">stl_res</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span><span class="n">metadata</span><span class="p">)</span>
<span class="n">anom</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">tsi</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39; (anom)&#39;</span>
<span class="n">anom</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Time [years CE]&#39;, ylabel=&#39;discharge [cf/s]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/8f7574c938a022484b2610cbf76b27b3f79345ea6cd8ee3121750cef19628f8d.png" src="../_images/8f7574c938a022484b2610cbf76b27b3f79345ea6cd8ee3121750cef19628f8d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd_a</span> <span class="o">=</span> <span class="n">anom</span><span class="o">.</span><span class="n">interp</span><span class="p">()</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mtm&#39;</span><span class="p">)</span>
<span class="n">psd_a</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/93557deef44ee8e962a549e572d3071a9f59a4cca703faa7ab72bf0e0e01f209.png" src="../_images/93557deef44ee8e962a549e572d3071a9f59a4cca703faa7ab72bf0e0e01f209.png" />
</div>
</div>
<p>Indeed this removed the annual cycle and its harmonics (for the most part). It’s a fairly aggressive treatment, but
we can now test the significance of the interannual peaks w.r.t to an AR(1) benchmark.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd_ar1</span> <span class="o">=</span> <span class="n">psd_a</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1sim&#39;</span><span class="p">,</span><span class="n">number</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">psd_ar1</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing spectral analysis on individual series: 100%|██████████| 1000/1000 [00:42&lt;00:00, 23.41it/s]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/2e183a67dda22dc15e7915377f2a1f8acf4f2a168db15022e7719402f48812f0.png" src="../_images/2e183a67dda22dc15e7915377f2a1f8acf4f2a168db15022e7719402f48812f0.png" />
</div>
</div>
<p>Note that we specified 1,000 surrogates to be used for this assessment of significance. The default is 200, but that is too few for research-grade applications, and certainly for publication.</p>
<p>If you wanted a colored-noise (power-law) benchmark instead, you would invoke it via the <code class="docutils literal notranslate"><span class="pre">method</span></code> argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd_cn</span> <span class="o">=</span> <span class="n">psd_a</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;CN&#39;</span><span class="p">,</span><span class="n">number</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">psd_cn</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing spectral analysis on individual series: 100%|██████████| 1000/1000 [00:43&lt;00:00, 23.22it/s]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/6ba22ea867881b8c1ec577bbd9f70e0dbbbf603a11b23b24ad079b329ebdda31.png" src="../_images/6ba22ea867881b8c1ec577bbd9f70e0dbbbf603a11b23b24ad079b329ebdda31.png" />
</div>
</div>
<p>We see that in both types of surrogates, the broadband peak in the 2-10y range is above the 95% threshold, so these frequencies could be considered significant.</p>
</section>
<section id="estimation-of-scaling-behavior">
<h2>Estimation of scaling behavior<a class="headerlink" href="#estimation-of-scaling-behavior" title="Link to this heading">#</a></h2>
<p>In this last example, <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> fit a single scaling exponent to the timeseries, spanning the entire range of frequencies(periods). Under the hood, all we are doing is fitting a straight line to the spectrum:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd_a</span><span class="o">.</span><span class="n">beta_est</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/9573970090ac3ff6b87464ed6b07c9e9b841678facfbc647d43e7329bdbc01c9.png" src="../_images/9573970090ac3ff6b87464ed6b07c9e9b841678facfbc647d43e7329bdbc01c9.png" />
</div>
</div>
<p>This results in a fairly steep exponent near 2.4. If we were specifically interested in the scaling exponent (spectral slope) between periods of 2-100y, you would do it like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd_a</span><span class="o">.</span><span class="n">beta_est</span><span class="p">(</span><span class="n">fmin</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/3b7fc0635bfb5a553355167312ca336d14c6d2ed59f316cde1228079fd136f08.png" src="../_images/3b7fc0635bfb5a553355167312ca336d14c6d2ed59f316cde1228079fd136f08.png" />
</div>
</div>
<p>We see that this results in a much flatter line, i.e. a smaller scaling exponent around 0.75</p>
</section>
<section id="gap-tolerant-spectral-analysis">
<h2>Gap-tolerant spectral analysis<a class="headerlink" href="#gap-tolerant-spectral-analysis" title="Link to this heading">#</a></h2>
<p>We return to the original series and apply 2 techniques to obtain the spectrum, keeping gaps in th series.</p>
<ol class="arabic simple">
<li><p>By default, <code class="docutils literal notranslate"><span class="pre">spectral()</span></code> invokes the Lomb-Scargle periodogram</p></li>
<li><p>method = <code class="docutils literal notranslate"><span class="pre">wwz</span></code> invokes the Weighted-Wavelet Z-transform</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd_ls</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">standardize</span><span class="p">()</span><span class="o">.</span><span class="n">spectral</span><span class="p">()</span>
<span class="n">psd_ls</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/6138025e2f81a3968d95cdea3e801c7db10798d8ff958cbee3dc77bb824ecd9c.png" src="../_images/6138025e2f81a3968d95cdea3e801c7db10798d8ff958cbee3dc77bb824ecd9c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd_wwz</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">standardize</span><span class="p">()</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">)</span>
<span class="n">psd_wwz</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/a4fdd12955cf3c473307819b7cbccf9d3a285bdbb4329181aa6576bbaf2e2bf3.png" src="../_images/a4fdd12955cf3c473307819b7cbccf9d3a285bdbb4329181aa6576bbaf2e2bf3.png" />
</div>
</div>
<p>Let’s plot all those spectra on the same figure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">psd_mtm</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;segment 2, MTM&#39;</span><span class="p">)</span>
<span class="n">psd_ls</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;whole series, Lomb-Scargle&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">psd_wwz</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;whole series, WWZ&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;Period [years]&#39;, ylabel=&#39;PSD&#39;&gt;
</pre></div>
</div>
<img alt="../_images/de16d107c4a30e2dbeaaff7a7b799c3e004d2b1cdad56d80da0732380ce6649c.png" src="../_images/de16d107c4a30e2dbeaaff7a7b799c3e004d2b1cdad56d80da0732380ce6649c.png" />
</div>
</div>
<p>It is often useful to be able to compare methods and/or parameter choices, to see if the results are robust. We see that some choices lump peaks into broad bands, others tend to slice them up.</p>
</section>
<section id="failed-ssa-attempt">
<h2>FAILED SSA attempt<a class="headerlink" href="#failed-ssa-attempt" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ssa</span> <span class="o">=</span> 
<span class="n">ssa</span><span class="o">.</span><span class="n">screeplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 600x400 with 1 Axes&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;SSA scree plot&#39;}, xlabel=&#39;Mode index $i$&#39;, ylabel=&#39;$\\lambda_i$&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/6dfe833f26b5de7a0b4210ec61fbce2b7fba1456333ed9248a79401a1017c370.png" src="../_images/6dfe833f26b5de7a0b4210ec61fbce2b7fba1456333ed9248a79401a1017c370.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">ssa</span><span class="o">.</span><span class="n">modeplot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/da33a12095cb3fad297e85c0ceda696acc27c27ee72c756d6dae8aaf431ff338.png" src="../_images/da33a12095cb3fad297e85c0ceda696acc27c27ee72c756d6dae8aaf431ff338.png" />
<img alt="../_images/612f1baf9a35b07ed140b3689dbb4997f102d8197249be3541cc1313bbe7978b.png" src="../_images/612f1baf9a35b07ed140b3689dbb4997f102d8197249be3541cc1313bbe7978b.png" />
<img alt="../_images/40527a54e910e27d7627d82ffc009f114c3ac47a34bb547bfe0cda7f3489ea36.png" src="../_images/40527a54e910e27d7627d82ffc009f114c3ac47a34bb547bfe0cda7f3489ea36.png" />
<img alt="../_images/a87a952f3fc0d5da87291dce46b911b781fa1ececc0cb6f652a7fd89ca6ad95e.png" src="../_images/a87a952f3fc0d5da87291dce46b911b781fa1ececc0cb6f652a7fd89ca6ad95e.png" />
<img alt="../_images/3cf33691e78f088a11ffa7fb5bb19b69cfec3ffbffc0b9faac294ee53ba4e467.png" src="../_images/3cf33691e78f088a11ffa7fb5bb19b69cfec3ffbffc0b9faac294ee53ba4e467.png" />
<img alt="../_images/2c0a1242907bbb95f1f6a864557f1b24900c7cb409ba98ef6fa77fde2797cfc3.png" src="../_images/2c0a1242907bbb95f1f6a864557f1b24900c7cb409ba98ef6fa77fde2797cfc3.png" />
<img alt="../_images/8c62110275cc73989d9292e4dc63831685f8fa369e8065d6cb285aaf136adc91.png" src="../_images/8c62110275cc73989d9292e4dc63831685f8fa369e8065d6cb285aaf136adc91.png" />
<img alt="../_images/b06ddbdbeac63ed531f059e91af56c9c7f8361fc25c7cde2c02db6de16f6747b.png" src="../_images/b06ddbdbeac63ed531f059e91af56c9c7f8361fc25c7cde2c02db6de16f6747b.png" />
<img alt="../_images/88403a3ea14aebdd042c9c449496640500396fed896b8fe5cfe9f477dee0ed76.png" src="../_images/88403a3ea14aebdd042c9c449496640500396fed896b8fe5cfe9f477dee0ed76.png" />
<img alt="../_images/0e70fa5089e2160f4f65b7ac92ae3e816ec45fd5e7cd102b090e9bb108b81798.png" src="../_images/0e70fa5089e2160f4f65b7ac92ae3e816ec45fd5e7cd102b090e9bb108b81798.png" />
</div>
</div>
<p>Subannual modes identified by SSA:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subannual_modes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">ssa</span><span class="o">.</span><span class="n">RCmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># number of modes</span>
<span class="n">modes2keep</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subannual_modes</span><span class="p">]</span> <span class="c1"># generate list of modes by list comprehension and range constructor</span>
<span class="n">modes2keep</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4,
 7,
 8,
 9,
 10,
 11,
 12,
 13,
 14,
 15,
 16,
 17,
 18,
 19,
 20,
 21,
 22,
 23,
 24,
 25,
 26,
 27,
 28,
 29,
 30,
 31,
 32,
 33,
 34,
 35,
 36,
 37,
 38,
 39,
 40,
 41,
 42,
 43,
 44,
 45,
 46,
 47,
 48,
 49,
 50,
 51,
 52,
 53,
 54,
 55,
 56,
 57,
 58,
 59,
 60,
 61,
 62,
 63,
 64,
 65,
 66,
 67,
 68,
 69,
 70,
 71,
 72,
 73,
 74,
 75,
 76,
 77,
 78,
 79,
 80,
 81,
 82,
 83,
 84,
 85,
 86,
 87,
 88,
 89,
 90,
 91,
 92,
 93,
 94,
 95,
 96,
 97,
 98,
 99,
 100,
 101,
 102,
 103,
 104,
 105,
 106,
 107,
 108,
 109,
 110,
 111,
 112,
 113,
 114,
 115,
 116,
 117,
 118,
 119,
 120,
 121,
 122,
 123,
 124,
 125,
 126,
 127,
 128,
 129,
 130,
 131,
 132,
 133,
 134,
 135,
 136,
 137,
 138,
 139,
 140,
 141,
 142,
 143,
 144,
 145,
 146,
 147,
 148,
 149,
 150,
 151,
 152,
 153,
 154,
 155,
 156,
 157,
 158,
 159,
 160,
 161,
 162,
 163,
 164,
 165,
 166,
 167,
 168,
 169,
 170,
 171,
 172,
 173,
 174,
 175,
 176,
 177,
 178,
 179,
 180,
 181,
 182,
 183,
 184,
 185,
 186,
 187,
 188,
 189,
 190,
 191,
 192,
 193,
 194,
 195,
 196,
 197,
 198,
 199,
 200,
 201,
 202,
 203,
 204,
 205,
 206,
 207,
 208,
 209,
 210,
 211,
 212,
 213,
 214,
 215,
 216,
 217,
 218,
 219,
 220,
 221,
 222,
 223,
 224,
 225,
 226,
 227,
 228,
 229,
 230,
 231,
 232,
 233,
 234,
 235,
 236,
 237,
 238,
 239,
 240,
 241,
 242,
 243,
 244,
 245,
 246,
 247,
 248,
 249,
 250,
 251,
 252,
 253,
 254,
 255,
 256,
 257,
 258,
 259,
 260,
 261,
 262,
 263,
 264,
 265,
 266,
 267,
 268,
 269,
 270,
 271,
 272,
 273,
 274,
 275,
 276,
 277,
 278,
 279,
 280,
 281,
 282,
 283,
 284,
 285,
 286,
 287,
 288,
 289,
 290,
 291,
 292,
 293,
 294,
 295,
 296,
 297,
 298,
 299,
 300,
 301,
 302,
 303,
 304,
 305,
 306,
 307,
 308,
 309,
 310,
 311,
 312,
 313,
 314,
 315,
 316,
 317,
 318,
 319,
 320,
 321,
 322,
 323,
 324,
 325,
 326,
 327,
 328,
 329,
 330,
 331,
 332,
 333,
 334,
 335,
 336,
 337,
 338,
 339,
 340,
 341,
 342,
 343,
 344,
 345,
 346,
 347,
 348,
 349,
 350,
 351,
 352,
 353,
 354,
 355,
 356,
 357,
 358,
 359,
 360,
 361,
 362,
 363,
 364,
 365,
 366,
 367,
 368,
 369,
 370,
 371,
 372,
 373,
 374,
 375,
 376,
 377,
 378,
 379,
 380,
 381,
 382,
 383,
 384,
 385,
 386,
 387,
 388,
 389,
 390,
 391,
 392,
 393,
 394,
 395,
 396,
 397,
 398,
 399,
 400,
 401,
 402,
 403,
 404,
 405,
 406,
 407,
 408,
 409,
 410,
 411,
 412,
 413,
 414,
 415,
 416,
 417,
 418,
 419,
 420,
 421,
 422,
 423,
 424,
 425,
 426,
 427,
 428,
 429,
 430,
 431,
 432,
 433,
 434,
 435,
 436,
 437,
 438,
 439,
 440,
 441,
 442,
 443,
 444,
 445,
 446,
 447,
 448,
 449,
 450,
 451,
 452,
 453,
 454,
 455,
 456,
 457,
 458,
 459,
 460,
 461,
 462,
 463,
 464,
 465,
 466,
 467,
 468,
 469,
 470,
 471,
 472,
 473,
 474,
 475,
 476,
 477,
 478,
 479,
 480,
 481,
 482,
 483,
 484,
 485,
 486,
 487,
 488,
 489,
 490,
 491,
 492,
 493,
 494,
 495,
 496,
 497,
 498,
 499,
 500,
 501,
 502,
 503,
 504,
 505,
 506,
 507,
 508,
 509,
 510,
 511,
 512,
 513,
 514,
 515,
 516,
 517,
 518,
 519,
 520,
 521,
 522,
 523,
 524,
 525,
 526,
 527,
 528,
 529,
 530,
 531,
 532,
 533,
 534,
 535]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_rc</span> <span class="o">=</span> <span class="n">ts_lwc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ts_rc</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ssa</span><span class="o">.</span><span class="n">RCmat</span><span class="p">[:,</span><span class="n">modes2keep</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_rc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SSA reconstruction&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Time [years CE]&#39;, ylabel=&#39;discharge [cf/s]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/8f27041554e082f8a3c569c06ac380c6118a9f3bc5aa2f6e4080b64059fae04e.png" src="../_images/8f27041554e082f8a3c569c06ac380c6118a9f3bc5aa2f6e4080b64059fae04e.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "pyleo"
        },
        kernelOptions: {
            name: "pyleo",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'pyleo'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Association.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 3: Measures of association</p>
      </div>
    </a>
    <a class="right-next"
       href="wavelets%26coherence.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 5: Wavelets and Coherency</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#packages">Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling">Data Wrangling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conversion-to-pyleoclim">Conversion to Pyleoclim</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gap-free-analysis">Gap-free analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-scaling-behavior">Estimation of scaling behavior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gap-tolerant-spectral-analysis">Gap-tolerant spectral analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#failed-ssa-attempt">FAILED SSA attempt</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Julien Emile-Geay
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>